 

​    几天前破姐了一个E盾的辅助，外挂本体没有VM，登陆后会释放两个加了VM的功能程序。今天又碰到一个E盾的瓜，当初便想到可以用那个辅助来帮助破姐加了VM的

前一个歪瓜的分析传送门

https://github.com/mizukiyyds/mypatch/tree/master/%E4%B8%80%E6%AC%BEE%E7%9B%BE%E6%B0%B8%E5%8A%AB%E6%97%A0%E9%97%B4%E8%BE%85%E5%8A%A9%E5%88%86%E6%9E%90





堆栈中偶然发现的东西，应该是歪瓜服务器地址

0018FE7C  |0051AC49  ASCII "39.104.124.136"



E盾首先会调用一个call检测OD，那么可以提取特征码，找到段首直接ret



加载启动窗体特征码（易语言体上面找不到push xxxxxxxx，本来想找窗体的加载call，不在这断下来，没用到）
56 8B F1 8B 4C 24 08 8D 44 24 08 6A 00 50 51 8D 8E 04 01 00 00 E8 ?? ?? ?? ??

E盾检测OD特征码（自己从段首到跳转到VM之前提取）
55 8B EC 81 EC 08 00 00 00 C7 45 FC 00 00 00 00 E?
补丁 0043DF71    C3              retn



登陆窗体

52025DB4

功能窗体
52025DB5





这就是检测call，在当前行ret即可绕过检测

![1.jpg](https://github.com/mizukiyyds/mypatch/blob/master/%E5%80%9F%E5%8A%A9%E5%89%8D%E5%87%A0%E5%A4%A9%E7%A0%B4%E7%9A%84E%E7%9B%BE%E8%BE%85%E5%8A%A9%E7%A0%B4%E5%A7%90%E5%8A%A0VMP%E7%9A%84E%E7%9B%BE%E5%8E%9F%E7%A5%9E%E6%8C%82/1.jpg)





然后测试push窗体能不能直接调用功能窗体，发现弹窗提示组件未加载，然后从MessageBox一直执行到程序关键加载代码，然后发现一个很无语的情况



00463E9D是功能窗体载入call的起始

这个作者在加载窗体前后调用了许多次读取组件属性和取标题，这样push过来肯定会报错，直接全部nop掉

这调用再多也无济于事

![image-20220609205838099](https://github.com/mizukiyyds/mypatch/blob/master/%E5%80%9F%E5%8A%A9%E5%89%8D%E5%87%A0%E5%A4%A9%E7%A0%B4%E7%9A%84E%E7%9B%BE%E8%BE%85%E5%8A%A9%E7%A0%B4%E5%A7%90%E5%8A%A0VMP%E7%9A%84E%E7%9B%BE%E5%8E%9F%E7%A5%9E%E6%8C%82/2.jpg)



00463EB4      90            nop
00463EB5      90            nop
00463EB6      90            nop
00463EB7      90            nop
00463EB8      90            nop

00463EF3      90            nop
00463EF4      90            nop
00463EF5      90            nop
00463EF6      90            nop
00463EF7      90            nop

00463F37      90            nop
00463F38      90            nop
00463F39      90            nop
00463F3A      90            nop
00463F3B      90            nop


00463F76      90            nop
00463F77      90            nop
00463F78      90            nop
00463F79      90            nop
00463F7A      90            nop

00463FBA      90            nop
00463FBB      90            nop
00463FBC      90            nop
00463FBD      90            nop
00463FBE      90            nop

00463FF9      90            nop
00463FFA      90            nop
00463FFB      90            nop
00463FFC      90            nop
00463FFD      90            nop

0046403D      90            nop
0046403E      90            nop
0046403F      90            nop
00464040      90            nop
00464041      90            nop

0046407C      90            nop
0046407D      90            nop
0046407E      90            nop
0046407F      90            nop
00464080      90            nop

然后运行起来，成功

![3](https://github.com/mizukiyyds/mypatch/blob/master/%E5%80%9F%E5%8A%A9%E5%89%8D%E5%87%A0%E5%A4%A9%E7%A0%B4%E7%9A%84E%E7%9B%BE%E8%BE%85%E5%8A%A9%E7%A0%B4%E5%A7%90%E5%8A%A0VMP%E7%9A%84E%E7%9B%BE%E5%8E%9F%E7%A5%9E%E6%8C%82/3.jpg)